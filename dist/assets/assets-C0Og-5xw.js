import{n as K,i as We,U as de}from"./id-factory-CW2C2ZcE.js";function qt(t,e){for(let n=0,r=t.length;n<r;n++)if(e(t[n]))return t[n]}function qe(t){if(Array.from)return Array.from(t);const e=[];for(;;){const{done:n,value:r}=t.next();if(n)break;e[e.length]=r}return e}function Jt(t,e,n){const r=e-t+1,i=new Int32Array(r);for(let o=0;o<r;o++)i[o]=o+t;return i}function Vt(t,e){const n=new(Je(t))(e.length);for(let r=0,i=e.length;r<i;r++)n[r]=t[e[r]];return n}function Je(t){const e=t.constructor;if(!e)throw new Error("data does not define a constructor and it should");return e}function Xt(t){return Object.keys(t)}function Ve(t){throw new Error("unreachable")}function Yt(t){return typeof(t==null?void 0:t.then)=="function"}const Qt={is(t){return typeof t.charCodeAt=="function"},toString(t){try{return t.toString()}catch(e){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${t.length} exceeds maximum allowed string length ${P}. (${e})`)}}},P=536870888,Z=28;class H{get length(){return this._length}constructor(e=Z){this._chunks=[],this._length=0,this._tmpArray=[],this.STRING_CHUNK_SIZE=2**e,this.STRING_CHUNK_SHIFT=e,this.STRING_CHUNK_MASK=2**e-1}static fromString(e,n=Z){const r=new H(n);return r._append(e),r}static fromStrings(e,n=Z){const r=new H(n);for(const i of e)r._append(i);return r}static fromUtf8Data(e,n=0,r=e.length,i=Z){const o=2**i,s=[];let c=n;for(;c<r;){let f=Math.min(c+o,r);if(f<r){for(;(e[f]&192)===128;)if(f--,f===c)throw new Error("Input is rubbish, no UTF-8 character start found in a chunk")}const a=X(e,c,f-c);s.push(a),c=f}return H.fromStrings(s,i)}_append(e){const n=this.STRING_CHUNK_SIZE,r=this._chunks.length===0||this._chunks[this._chunks.length-1].length===n?"":this._chunks.pop();let i=n-r.length;for(this._chunks.push(r+e.substring(0,i));i<e.length;)this._chunks.push(e.substring(i,i+n)),i+=n;this._length+=e.length}_getChunkIndex(e){return e>>>this.STRING_CHUNK_SHIFT}_getIndexInChunk(e){return e&this.STRING_CHUNK_MASK}_isOutOfRange(e){return e<0||e>=this.length}at(e){return-this.length<=e&&e<0?this.at(e+this.length):this.charAt(e)||void 0}charAt(e){if(this._isOutOfRange(e))return"";const n=this._getChunkIndex(e),r=this._getIndexInChunk(e);return this._chunks[n][r]}charCodeAt(e){if(this._isOutOfRange(e))return NaN;const n=this._getChunkIndex(e),r=this._getIndexInChunk(e);return this._chunks[n].charCodeAt(r)}substring(e,n){const r=Math.min(Math.max(e??0,0),this.length),i=Math.min(Math.max(n??this.length,0),this.length);if(r>i)return this.substring(i,r);if(r===i)return"";if(i-r>P)throw new Error(`Trying to create get a substring longer (${i-r}) than maximum allowed string length (${P}).`);const o=this._getChunkIndex(r),s=this._getIndexInChunk(r),c=this._getChunkIndex(i),f=this._getIndexInChunk(i);if(o===c)return this._chunks[o].substring(s,f);{const a=this._getTmpArray();a.push(this._chunks[o].substring(s,this.STRING_CHUNK_SIZE));for(let u=o+1;u<c;u++)a.push(this._chunks[u]);return a.push(this._chunks[c].substring(0,f)),a.join("")}}_getTmpArray(){for(;this._tmpArray.length;)this._tmpArray.pop();return this._tmpArray}indexOf(e,n=0){if(e.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: indexOf is only implemented for searchString shorter than STRING_CHUNK_SIZE");n<0&&(n=0);const r=this._getChunkIndex(n);for(let i=r;i<this._chunks.length;i++){const o=this._chunks[i],s=i===r?this._getIndexInChunk(n):0,c=o.indexOf(e,s);if(c>=0)return i*this.STRING_CHUNK_SIZE+c;if(i!==this._chunks.length-1){const f=Math.max(this.STRING_CHUNK_SIZE-e.length+1,s),u=(o.substring(f,void 0)+this._chunks[i+1].substring(0,e.length-1)).indexOf(e);if(u>=0)return i*this.STRING_CHUNK_SIZE+f+u}}return-1}includes(e,n=0){return this.indexOf(e,n)>=0}startsWith(e,n=0){if(e.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: startsWith is only implemented for searchString shorter than STRING_CHUNK_SIZE");return this.substring(n,n+e.length)===e}toString(){try{return this._chunks.join("")}catch(e){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${this.length} exceeds maximum allowed string length ${P}. (${e})`)}}}function en(t,e,n){for(let r=0,i=n.length;r<i;r++){const o=n.charCodeAt(r);if(o<128){t[e++]=o>>>0&127|0;continue}if(o<2048){t[e++]=o>>>6&31|192,t[e++]=o>>>0&63|128;continue}if(o<65536){t[e++]=o>>>12&15|224,t[e++]=o>>>6&63|128,t[e++]=o>>>0&63|128;continue}if(o<1114112){t[e++]=o>>>18&7|240,t[e++]=o>>>12&63|128,t[e++]=o>>>6&63|128,t[e++]=o>>>0&63|128;continue}throw new Error("bad codepoint "+o)}}const Xe=function(){const t=[];for(let e=0;e<1024;e++)t[e]=String.fromCharCode(e);return t}();function Ue(t){throw new Error(t)}function Ye(t,e,n){const r=Xe;let i,o=0;const s=[],c=512;for(let f=e,a=e+n;f<a;f++){const u=t[f];u&128?(u&224)===192?s[o++]=r[(u&15)<<6|t[++f]&63]:(u&240)===224?s[o++]=String.fromCharCode((u&15)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0):(u&248)===240?s[o++]=String.fromCharCode((u&7)<<18|(t[++f]&63)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0):Ue("Invalid byte "+u.toString(16)):s[o++]=r[u],o===c&&(i=i||[],i[i.length]=s.join(""),o=0)}return i?(o>0&&(i[i.length]=s.slice(0,o).join("")),i.join("")):s.slice(0,o).join("")}const ge=typeof TextDecoder<"u"?new TextDecoder:void 0;function X(t,e=0,n=t.length){if(ge){const r=e||n!==t.length?t.subarray(e,e+n):t;return ge.decode(r)}else return Ye(t,e,n)}function Qe(t,e=0,n=t.length){if(n<=P)return X(t,e,n);const r=H.fromUtf8Data(t,e,e+n);return r.length<=P?r.toString():r}function tn(t){let e=0;for(let n=0,r=t.length;n<r;n++){const i=t.charCodeAt(n);if(i<128){e+=1;continue}if(i<2048){e+=2;continue}if(i<65536){e+=3;continue}if(i<1114112){e+=4;continue}Ue("bad codepoint "+i)}return e}function et(){const t=function(){const g=typeof window<"u"&&window,p=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return g||typeof global<"u"&&global||p}(),e={},n=typeof document<"u"?document:void 0;let r=1,i;function o(g,...p){typeof g!="function"&&(g=new Function(""+g));const w={callback:g,args:p};return e[r]=w,i(r),r++}function s(g){delete e[g]}function c(g){const p=g.callback,w=g.args;switch(w.length){case 0:p();break;case 1:p(w[0]);break;case 2:p(w[0],w[1]);break;case 3:p(w[0],w[1],w[2]);break;default:p.apply(void 0,w);break}}function f(g){const p=e[g];s(g),c(p)}function a(){i=function(g){process.nextTick(function(){f(g)})}}function u(){if(t&&t.postMessage&&!t.importScripts){let g=!0;const p=t.onmessage;return t.onmessage=function(){g=!1},t.postMessage("","*"),t.onmessage=p,g}}function h(){const g="setImmediate$"+Math.random()+"$",p=function(w){w.source===t&&typeof w.data=="string"&&w.data.indexOf(g)===0&&f(+w.data.slice(g.length))};window.addEventListener?window.addEventListener("message",p,!1):window.attachEvent("onmessage",p),i=function(w){window.postMessage(g+w,"*")}}function d(){const g=new MessageChannel;g.port1.onmessage=function(p){const w=p.data;f(w)},i=function(p){g.port2.postMessage(p)}}function b(){const g=n.documentElement;i=function(p){let w=n.createElement("script");w.onreadystatechange=function(){f(p),w.onreadystatechange=null,g.removeChild(w),w=null},g.appendChild(w)}}function m(){i=function(g){setTimeout(f,0,g)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?a():u()?h():typeof MessageChannel<"u"?d():n&&"onreadystatechange"in n.createElement("script")?b():m(),{setImmediate:o,clearImmediate:s}}const fe=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(t,...e)=>window.setImmediate(t,...e),clearImmediate:t=>window.clearImmediate(t)}:{setImmediate,clearImmediate}:et()}();function tt(t){fe.setImmediate(t)}const nt={setImmediate:fe.setImmediate,clearImmediate:fe.clearImmediate,immediatePromise(){return new Promise(tt)},delay(t,e=void 0){return new Promise(n=>setTimeout(n,t,e))}};var rt={};let nn=function(){try{return!0}catch{return!1}}(),rn=function(){try{const e=rt.DEBUG;return e==="*"||e==="molstar"}catch{return!1}}();var D;(function(t){function e(i){}t.markStart=e;function n(i){}t.markEnd=n;function r(i){}t.measure=r})(D||(D={}));function it(t,e,n=250){const r=Ee(t,e,n),i=new Y(r,r.root);return ue(t,i)}function sn(t,e,n=250){const r=Ee(t,e,n);return new Y(r,r.root)}function st(t,e){return ue(e,t)}function ot(t,e,n){return t.runChild(e,n)}function Ne(t){return{taskId:t.id,taskName:t.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function Ee(t,e,n){const r={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:n,lastNotified:K(),observer:e,abortToken:r,taskId:t.id,root:{progress:Ne(t),children:[]},tryAbort:ft(r)}}function ft(t){return e=>{t.abortRequested=!0,t.reason=e||t.reason}}function Fe(t){return{progress:{...t.progress},children:t.children.map(Fe)}}function Te(t){return t.progress.canAbort&&t.children.every(Te)}function ct(t){return{root:Fe(t.root),canAbort:Te(t.root),requestAbort:t.tryAbort}}async function ue(t,e){D.markStart(t),e.node.progress.startedTime=K();try{const n=await t.f(e);return D.markEnd(t),D.measure(t),e.info.abortToken.abortRequested&&Re(e.info),n}catch(n){throw C.isAbort(n)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise(r=>{e.onChildrenFinished=r}),t.onAbort&&t.onAbort()),n}}function Re(t){throw t.abortToken.treeAborted||(t.abortToken.treeAborted=!0,$e(t.root),Me(t,K())),C.Aborted(t.abortToken.reason)}function $e(t){const e=t.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const n of t.children)$e(n)}function Me(t,e){t.lastNotified=e;const n=ct(t);t.observer(n)}class Y{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,Re(this.info))}get shouldUpdate(){return this.checkAborted(),K()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const n=this.node.progress;typeof e=="string"?(n.message=e,n.isIndeterminate=!0):(typeof e.canAbort<"u"&&(n.canAbort=e.canAbort),typeof e.message<"u"&&(n.message=e.message),typeof e.current<"u"&&(n.current=e.current),typeof e.max<"u"&&(n.max=e.max),n.isIndeterminate=typeof n.current>"u"||typeof n.max>"u",typeof e.isIndeterminate<"u"&&(n.isIndeterminate=e.isIndeterminate))}update(e,n){if(this.lastUpdatedTime=K(),this.updateProgress(e),!n)return Me(this.info,this.lastUpdatedTime),this.checkAborted(),nt.immediatePromise()}async runChild(e,n){this.updateProgress(n);const r={progress:Ne(e),children:[]},i=this.node.children;i.push(r);const o=new Y(this.info,r);try{return await ue(e,o)}catch(s){if(C.isAbort(s)&&this.isAborted)return;throw s}finally{const s=i.indexOf(r);if(s>=0){for(let c=s,f=i.length-1;c<f;c++)i[c]=i[c+1];i.pop()}i.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,n){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=n,this.info=e}}class lt{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(e,n){}}const J=new lt;var C;(function(t){class e{run(d,b=250){return d?it(this,d,b):this.f(J)}runAsChild(d,b){return d.isSynchronous?this.f(J):ot(d,this,b)}runInContext(d){return d.isSynchronous?this.f(J):st(d,this)}constructor(d,b,m){this.name=d,this.f=b,this.onAbort=m,this.id=u()}}function n(h){const d=h;return!!h&&typeof d.id=="number"&&typeof d.name=="string"&&!!d.run}t.is=n;function r(h){return!!h&&!!h.isAborted}t.isAbort=r;function i(h){return{isAborted:!0,reason:h,toString(){return`Aborted${h?": "+h:""}`}}}t.Aborted=i;function o(h,d,b){return new e(h,d,b)}t.create=o;function s(h,d){return o(h,async b=>d)}t.constant=s;function c(){return o("",async h=>{})}t.empty=c;function f(h,d){return o(h,async b=>{throw new Error(d)})}t.fail=f;function a(h,d){return n(h)?d?h.runInContext(d):h.run():h}t.resolveInContext=a;const u=We(0,1073741823)})(C||(C={}));var me;(function(t){t.Synchronous=J})(me||(me={}));var we;(function(t){function e(r,i=""){const o=r.progress;if(!r.children.length)return o.isIndeterminate?`${i}${o.taskName}: ${o.message}`:`${i}${o.taskName}: [${o.current}/${o.max}] ${o.message}`;const s=i+"  |_ ",c=r.children.map(f=>e(f,s));return o.isIndeterminate?`${i}${o.taskName}: ${o.message}
${c.join(`
`)}`:`${i}${o.taskName}: [${o.current}/${o.max}] ${o.message}
${c.join(`
`)}`}function n(r){return e(r.root)}t.format=n})(we||(we={}));const R=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,be=ut();function ut(){if(typeof File>"u"||R){class t{arrayBuffer(){return this.blob.arrayBuffer()}slice(n,r,i){return this.blob.slice(n,r,i)}stream(){return this.blob.stream()}text(){return this.blob.text()}bytes(){return this.blob.bytes()}constructor(n,r,i){var o;this.blob=new Blob(n,i),this.size=this.blob.size,this.type=this.blob.type,this.name=r,this.lastModified=(o=i==null?void 0:i.lastModified)!==null&&o!==void 0?o:0,this.webkitRelativePath=""}}return t}else return File}function at(t){return t>>0}function N(t,e){return t[e]|t[e+1]<<8}function M(t,e,n){t[e]=n&255,t[e+1]=n>>8&255}function z(t,e){return t[e+3]*(256*256*256)+(t[e+2]<<16|t[e+1]<<8|t[e])}function U(t,e,n){t[e]=n&255,t[e+1]=n>>8&255,t[e+2]=n>>16&255,t[e+3]=n>>24&255}function ht(t,e,n){let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(t[e+i]);return r}function dt(t){return t.length<2?"0"+t:t}function gt(t,e,n){let r="",i;for(let o=0;o<n;o++)r+="%"+dt(t[e+o].toString(16));try{i=decodeURIComponent(r)}catch{return ht(t,e,n)}return i}function mt(t,e,n){const r=n.length;let i=0;for(let o=0;o<r;o++){const s=n.charCodeAt(o);if(!(s&4294967168))t[e+i]=s,i++;else if(!(s&4294965248))t[e+i]=192|s>>6,t[e+i+1]=128|s>>0&63,i+=2;else if(!(s&4294901760))t[e+i]=224|s>>12,t[e+i+1]=128|s>>6&63,t[e+i+2]=128|s>>0&63,i+=3;else if(!(s&4294967295-(1<<21)+1))t[e+i]=240|s>>18,t[e+i+1]=128|s>>12&63,t[e+i+2]=128|s>>6&63,t[e+i+3]=128|s>>0&63,i+=4;else throw new Error("e")}return i}function Oe(t){const e=t.length;let n=0;for(let r=0;r<e;r++){const i=t.charCodeAt(r);if(!(i&4294967168))n++;else if(!(i&4294965248))n+=2;else if(!(i&4294901760))n+=3;else if(!(i&4294967295-(1<<21)+1))n+=4;else throw new Error("e")}return n}const wt=function(){const t=new Uint32Array(256);for(let e=0;e<256;e++){let n=e;for(let r=0;r<8;r++)n&1?n=3988292384^n>>>1:n=n>>>1;t[e]=n}return t}();function bt(t,e,n,r){for(let i=0;i<r;i++)t=wt[(t^e[n+i])&255]^t>>>8;return t}function ze(t,e,n){return bt(4294967295,t,e,n)^4294967295}const W={deflate:void 0,"deflate-raw":void 0,gzip:void 0};function Pe(t){if(W[t]===void 0)try{new CompressionStream(t),W[t]=!0}catch{W[t]=!1}return!!W[t]}const l=function(){const t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(65536),prev:new t(32768)}}();(function(){for(let n=0;n<32768;n++){let r=n;r=(r&2863311530)>>>1|(r&1431655765)<<1,r=(r&3435973836)>>>2|(r&858993459)<<2,r=(r&4042322160)>>>4|(r&252645135)<<4,r=(r&4278255360)>>>8|(r&16711935)<<8,l.rev15[n]=(r>>>16|r<<16)>>>17}function e(n,r,i){for(;r--!==0;)n.push(0,i)}for(let n=0;n<32;n++)l.ldef[n]=l.of0[n]<<3|l.exb[n],l.ddef[n]=l.df0[n]<<4|l.dxb[n];e(l.fltree,144,8),e(l.fltree,112,9),e(l.fltree,24,7),e(l.fltree,8,8),T(l.fltree,9),L(l.fltree,9,l.flmap),B(l.fltree,9),e(l.fdtree,32,5),T(l.fdtree,5),L(l.fdtree,5,l.fdmap),B(l.fdtree,5),e(l.itree,19,0),e(l.ltree,286,0),e(l.dtree,30,0),e(l.ttree,320,0)})();function L(t,e,n){const r=t.length,i=l.rev15;for(let o=0;o<r;o+=2)if(t[o+1]!==0){const s=o>>1,c=t[o+1],f=s<<4|c,a=e-c;let u=t[o]<<a;const h=u+(1<<a);for(;u!==h;){const d=i[u]>>>15-e;n[d]=f,u++}}}function T(t,e){const n=t.length,r=l.bl_count;for(let s=0;s<=e;s++)r[s]=0;for(let s=1;s<n;s+=2)r[t[s]]++;const i=l.next_code;let o=0;r[0]=0;for(let s=1;s<=e;s++)o=o+r[s-1]<<1,i[s]=o;for(let s=0;s<n;s+=2){const c=t[s+1];c!==0&&(t[s]=i[c],i[c]++)}}function B(t,e){const n=l.rev15,r=15-e;for(let i=0;i<t.length;i+=2){const o=t[i]<<e-t[i+1];t[i]=n[o]>>>r}}function pt(t,e){const n=e===void 0;return e===void 0&&(e=new Uint8Array(t.length>>>2<<3)),{data:t,buf:e,noBuf:n,BFINAL:0,off:0,pos:0}}function yt(t,e){const{data:n,noBuf:r}=t;let{buf:i,BFINAL:o,off:s,pos:c}=t,f=0;for(;o===0&&f<e;){let a,u,h=0,d=0;o=se(n,c,1),f+=1;const b=se(n,c+1,2);if(c+=3,b===0){c&7&&(c+=8-(c&7));const m=(c>>>3)+4,g=n[m-4]|n[m-3]<<8;r&&(i=ie(i,s+g)),i.set(new Uint8Array(n.buffer,n.byteOffset+m,g),s),c=m+g<<3,s+=g;continue}if(r&&(i=ie(i,s+(1<<17))),b===1)a=l.flmap,u=l.fdmap,h=511,d=31;else if(b===2){const m=F(n,c,5)+257,g=F(n,c+5,5)+1,p=F(n,c+10,4)+4;c+=14;for(let _=0;_<38;_+=2)l.itree[_]=0,l.itree[_+1]=0;let w=1;for(let _=0;_<p;_++){const y=F(n,c+_*3,3);l.itree[(l.ordr[_]<<1)+1]=y,y>w&&(w=y)}c+=3*p,T(l.itree,w),L(l.itree,w,l.imap),a=l.lmap,u=l.dmap,c=xt(l.imap,(1<<w)-1,m+g,n,c,l.ttree);const I=pe(l.ttree,0,m,l.ltree);h=(1<<I)-1;const x=pe(l.ttree,m,g,l.dtree);d=(1<<x)-1,T(l.ltree,I),L(l.ltree,I,a),T(l.dtree,x),L(l.dtree,x,u)}else throw new Error(`unknown BTYPE ${b}`);for(;;){const m=a[ce(n,c)&h];c+=m&15;const g=m>>>4;if(!(g>>>8))i[s++]=g;else{if(g===256)break;{let p=s+g-254;if(g>264){const y=l.ldef[g-257];p=s+(y>>>3)+F(n,c,y&7),c+=y&7}const w=u[ce(n,c)&d];c+=w&15;const I=w>>>4,x=l.ddef[I],_=(x>>>4)+se(n,c,x&15);for(c+=x&15,r&&(i=ie(i,s+(1<<17)));s<p;)i[s]=i[s++-_],i[s]=i[s++-_],i[s]=i[s++-_],i[s]=i[s++-_];s=p}}}}t.buf=i,t.BFINAL=o,t.off=s,t.pos=c}async function _t(t,e,n){if(e[0]===3&&e[1]===0)return n||new Uint8Array(0);if(Pe("deflate-raw")){const i=new DecompressionStream("deflate-raw"),s=new Blob([e]).stream().pipeThrough(i);let c=0;const f=[],a=s.getReader(),u=async()=>{const{done:h,value:d}=await a.read();if(!h)return t.shouldUpdate&&await t.update({message:"Inflating blocks...",current:c,max:n==null?void 0:n.length}),n?n.set(d,c):f.push(d),c+=d.length,u()};if(await u(),!n){n=new Uint8Array(c);for(let h=0,d=0;h<f.length;h++)n.set(f[h],d),d+=f[h].length}return n}const r=pt(e,n);for(;r.BFINAL===0;)t.shouldUpdate&&await t.update({message:"Inflating blocks...",current:r.pos,max:e.length}),yt(r,100);return r.buf.length===r.off?r.buf:r.buf.slice(0,r.off)}function ie(t,e){const n=t.length;if(e<=n)return t;const r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function xt(t,e,n,r,i,o){let s=0;for(;s<n;){const c=t[ce(r,i)&e];i+=c&15;const f=c>>>4;if(f<=15)o[s]=f,s++;else{let a=0,u=0;f===16?(u=3+F(r,i,2),i+=2,a=o[s-1]):f===17?(u=3+F(r,i,3),i+=3):f===18&&(u=11+F(r,i,7),i+=7);const h=s+u;for(;s<h;)o[s]=a,s++}}return i}function pe(t,e,n,r){let i=0,o=0;const s=r.length>>>1;for(;o<n;){const c=t[o+e];r[o<<1]=0,r[(o<<1)+1]=c,c>i&&(i=c),o++}for(;o<s;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function F(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(e&7)&(1<<n)-1}function se(t,e,n){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)&(1<<n)-1}function ce(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(e&7)}function oe(t,e,n){const r=[],i=t.length,o=e.length;for(let m=0;m<o;m+=2)e[m]=0,e[m+1]=0;for(let m=0;m<i;m++)t[m]!==0&&r.push({lit:m,f:t[m],d:void 0});const s=r.length,c=r.slice(0);if(s===0)return 0;if(s===1){const m=r[0].lit,g=m===0?1:0;return e[(m<<1)+1]=1,e[(g<<1)+1]=1,1}r.sort(function(m,g){return m.f-g.f});let f=r[0],a=r[1],u=0,h=1,d=2;for(r[0]={lit:-1,f:f.f+a.f,l:f,r:a,d:0};h!==s-1;)u!==h&&(d===s||r[u].f<r[d].f)?f=r[u++]:f=r[d++],u!==h&&(d===s||r[u].f<r[d].f)?a=r[u++]:a=r[d++],r[h++]={lit:-1,f:f.f+a.f,l:f,r:a,d:void 0};let b=le(r[h-1],0);b>n&&(It(c,n,b),b=n);for(let m=0;m<s;m++)e[(c[m].lit<<1)+1]=c[m].d;return b}function le(t,e){return t.lit!==-1?(t.d=e,e):Math.max(le(t.l,e+1),le(t.r,e+1))}function It(t,e,n){let r=0,i=0;const o=1<<n-e;for(t.sort(function(s,c){return c.d===s.d?s.f-c.f:c.d-s.d}),r=0;r<t.length&&t[r].d>e;r++){const s=t[r].d;t[r].d=e,i+=o-(1<<n-s)}for(i=i>>>n-e;i>0;){const s=t[r].d;s<e?(t[r].d++,i-=1<<e-s-1):r++}for(;r>=0;r--)t[r].d===e&&i<0&&(t[r].d--,i++);i!==0&&console.log("debt left")}function Ct(t,e,n,r){const{lits:i,strt:o,prev:s}=l;return{data:t,out:e,opt:kt[r],i:0,pos:n<<3,cvrd:0,dlen:t.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:o,prev:s}}function At(t,e){const{data:n,dlen:r,out:i,opt:o}=t;let{i:s,pos:c,cvrd:f,li:a,lc:u,bs:h,ebits:d,c:b,nc:m}=t;const{lits:g,strt:p,prev:w}=l,I=Math.min(s+e,r);for(;s<I;s++){if(b=m,s+1<r-2){m=ae(n,s+1);const x=s+1&32767;w[x]=p[m],p[m]=x}if(f<=s){(a>14e3||u>26697)&&r-s>100&&(f<s&&(g[a]=s-f,a+=2,f=s),c=Ge(s===r-1||f===r?1:0,g,a,d,n,h,s-h,i,c),a=u=d=0,h=s);let x=0;if(s<r-2&&(x=vt(n,s,w,b,Math.min(o[2],r-s),o[3])),x!==0){const _=x>>>16,y=x&65535,$=xe(_,l.of0);l.lhst[257+$]++;const E=xe(y,l.df0);l.dhst[E]++,d+=l.exb[$]+l.dxb[E],g[a]=_<<23|s-f,g[a+1]=y<<16|$<<8|E,a+=2,f=s+_}else l.lhst[n[s]]++;u++}}t.i=s,t.pos=c,t.cvrd=f,t.li=a,t.lc=u,t.bs=h,t.ebits=d,t.c=b,t.nc=m}const kt=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];async function St(t,e,n,r,i){if(Pe("deflate-raw")){const m=new CompressionStream("deflate-raw"),w=new Blob([e]).stream().pipeThrough(m).getReader();let I=r;const x=async()=>{const{done:_,value:y}=await w.read();if(!_)return t.shouldUpdate&&await t.update({message:"Deflating...",current:I,max:n.length}),n.set(y,I),I+=y.length,x()};return await x(),I}const o=Ct(e,n,r,i),{dlen:s}=o;if(i===0){let{i:m,pos:g}=o;for(;m<s;){const p=Math.min(65535,s-m);O(n,g,m+p===s?1:0),g=je(e,m,p,n,g+8),m+=p}return g>>>3}for(s>2&&(o.nc=ae(e,0),o.strt[o.nc]=0);o.i<s;)t.shouldUpdate&&await t.update({message:"Deflating...",current:o.i,max:s}),At(o,1024*1024);let{li:c,cvrd:f,pos:a}=o;const{i:u,lits:h,bs:d,ebits:b}=o;for((d!==u||e.length===0)&&(f<u&&(h[c]=u-f,c+=2,f=u),a=Ge(1,h,c,b,e,d,u-d,n,a));a&7;)a++;return a>>>3}function vt(t,e,n,r,i,o){let s=e&32767,c=n[s],f=s-c+32768&32767;if(c===s||r!==ae(t,e-f))return 0;let a=0,u=0;const h=Math.min(32767,e);for(;f<=h&&--o!==0&&c!==s;){if(a===0||t[e+a]===t[e+a-f]){let d=Ut(t,e,f);if(d>a){if(a=d,u=f,a>=i)break;f+2<d&&(d=f+2);let b=0;for(let m=0;m<d-2;m++){const g=e-f+m+32768&32767,p=n[g],w=g-p+32768&32767;w>b&&(b=w,c=g)}}}s=c,c=n[s],f+=s-c+32768&32767}return a<<16|u}function Ut(t,e,n){if(t[e]!==t[e-n]||t[e+1]!==t[e+1-n]||t[e+2]!==t[e+2-n])return 0;const r=e,i=Math.min(t.length,e+258);for(e+=3;e<i&&t[e]===t[e-n];)e++;return e-r}function ae(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535}function Ge(t,e,n,r,i,o,s,c,f){l.lhst[256]++;const[a,u,h,d,b,m,g,p]=Nt(),w=(f+3&7?8-(f+3&7):0)+32+(s<<3),I=r+G(l.fltree,l.lhst)+G(l.fdtree,l.dhst);let x=r+G(l.ltree,l.lhst)+G(l.dtree,l.dhst);x+=14+3*m+G(l.itree,l.ihst)+(l.ihst[16]*2+l.ihst[17]*3+l.ihst[18]*7);for(let y=0;y<286;y++)l.lhst[y]=0;for(let y=0;y<30;y++)l.dhst[y]=0;for(let y=0;y<19;y++)l.ihst[y]=0;const _=w<I&&w<x?0:I<x?1:2;if(V(c,f,t),V(c,f+1,_),f+=3,_===0){for(;f&7;)f++;f=je(i,o,s,c,f)}else{let y,$;if(_===1)y=l.fltree,$=l.fdtree;else if(_===2){T(l.ltree,a),B(l.ltree,a),T(l.dtree,u),B(l.dtree,u),T(l.itree,h),B(l.itree,h),y=l.ltree,$=l.dtree,O(c,f,d-257),f+=5,O(c,f,b-1),f+=5,O(c,f,m-4),f+=4;for(let v=0;v<m;v++)O(c,f+v*3,l.itree[(l.ordr[v]<<1)+1]);f+=3*m,f=ye(g,l.itree,c,f),f=ye(p,l.itree,c,f)}else Ve();let E=o;for(let v=0;v<n;v+=2){const he=e[v],ee=he>>>23,Ke=E+(he&(1<<23)-1);for(;E<Ke;)f=j(i[E++],y,c,f);if(ee!==0){const te=e[v+1],Ze=te>>16,ne=te>>8&255,re=te&255;f=j(257+ne,y,c,f),O(c,f,ee-l.of0[ne]),f+=l.exb[ne],f=j(re,$,c,f),V(c,f,Ze-l.df0[re]),f+=l.dxb[re],E+=ee}}f=j(256,y,c,f)}return f}function je(t,e,n,r,i){let o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(t.buffer,e,n),o),i+(n+4<<3)}function Nt(){const t=oe(l.lhst,l.ltree,15),e=oe(l.dhst,l.dtree,15),n=[],r=_e(l.ltree,n),i=[],o=_e(l.dtree,i);for(let f=0;f<n.length;f+=2)l.ihst[n[f]]++;for(let f=0;f<i.length;f+=2)l.ihst[i[f]]++;const s=oe(l.ihst,l.itree,7);let c=19;for(;c>4&&l.itree[(l.ordr[c-1]<<1)+1]===0;)c--;return[t,e,s,r,o,c,n,i]}function G(t,e){let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[(r<<1)+1];return n}function ye(t,e,n,r){for(let i=0;i<t.length;i+=2){const o=t[i],s=t[i+1];r=j(o,e,n,r);const c=o===16?2:o===17?3:7;o>15&&(O(n,r,s),r+=c)}return r}function _e(t,e){let n=t.length;for(;n!==2&&t[n-1]===0;)n-=2;for(let r=0;r<n;r+=2){const i=t[r+1],o=r+3<n?t[r+3]:-1,s=r+5<n?t[r+5]:-1,c=r===0?-1:t[r-1];if(i===0&&o===i&&s===i){let f=r+5;for(;f+2<n&&t[f+2]===i;)f+=2;const a=Math.min(f+1-r>>>1,138);a<11?e.push(17,a-3):e.push(18,a-11),r+=a*2-2}else if(i===c&&o===i&&s===i){let f=r+5;for(;f+2<n&&t[f+2]===i;)f+=2;const a=Math.min(f+1-r>>>1,6);e.push(16,a-3),r+=a*2-2}else e.push(i,0)}return n>>>1}function xe(t,e){let n=0;return e[n|16]<=t&&(n|=16),e[n|8]<=t&&(n|=8),e[n|4]<=t&&(n|=4),e[n|2]<=t&&(n|=2),e[n|1]<=t&&(n|=1),n}function j(t,e,n,r){return V(n,r,e[t<<1]),r+e[(t<<1)+1]}function O(t,e,n){n=n<<(e&7);const r=e>>>3;t[r]|=n,t[r+1]|=n>>>8}function V(t,e,n){n=n<<(e&7);const r=e>>>3;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16}async function He(t,e,n=!1){const r=Object.create(null),i=new Uint8Array(e);if(N(i,0)!==19280)throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).');let o=i.length-4;for(;z(i,o)!==101010256;)o--;let s=o;s+=4,s+=4;const c=N(i,s);s+=2,s+=2,s+=4;const f=z(i,s);s+=4,s=f;for(let a=0;a<c;a++){s+=4,s+=4,s+=4,s+=4,s+=4,s+=4,s+=4;const u=N(i,s),h=N(i,s+2),d=N(i,s+4);s+=6,s+=8;const b=z(i,s);s+=4,s+=u+h+d,await Et(t,i,b,r,n)}return r}async function Et(t,e,n,r,i){n+=4,n+=2,n+=2;const o=N(e,n);n+=2,n+=4,n+=4;const s=z(e,n);n+=4;const c=z(e,n);n+=4;const f=N(e,n);n+=2;const a=N(e,n);n+=2;const u=gt(e,n,f);if(n+=f,n+=a,i){r[u]={size:c,csize:s};return}const h=new Uint8Array(e.buffer,n,s);if(o===0)r[u]=h;else if(o===8){const d=new Uint8Array(c);await De(t,h,d),r[u]=d}else throw new Error(`unknown compression method: ${o}`)}async function De(t,e,n){return _t(t,e,n)}async function Ft(t,e,n){const r=e[3];let i=10;if(r&4){const u=N(e,i);i+=u}if(r&8){let u=i;for(;e[u]!==0;)++u;i=u+1}if(r&16){let u=i;for(;e[u]!==0;)++u;i=u+1}r&1&&(i+=2);const o=at(z(e,e.length-8)),s=z(e,e.length-4);n===void 0&&(n=new Uint8Array(s));const c=new Uint8Array(e.buffer,e.byteOffset+i,e.length-i-8),f=await De(t,c,n),a=ze(f,0,f.length);return o!==a&&console.error("ungzip: checksums don't match"),f}async function Tt(t,e,n){n===void 0&&(n={level:6});const r=new Uint8Array(50+Math.floor(e.length*1.1)),i=await St(t,e,r,0,n.level);return new Uint8Array(r.buffer,0,i)}function on(t,e=!1){return C.create("Zip",n=>Rt(n,t,e))}async function Rt(t,e,n=!1){let r=0;const i={};for(const h in e){const d=!$t(h)&&!n,b=e[h],m=ze(b,0,b.length);i[h]={cpr:d,usize:b.length,crc:m,file:d?await Tt(t,b):b}}for(const h in i)r+=i[h].file.length+30+46+2*Oe(h);r+=22;const o=new Uint8Array(r);let s=0;const c=[];for(const h in i){const d=i[h];c.push(s),s=Ie(o,s,h,d,0)}let f=0;const a=s;for(const h in i){const d=i[h];c.push(s),s=Ie(o,s,h,d,1,c[f++])}const u=s-a;return U(o,s,101010256),s+=4,s+=4,M(o,s,f),s+=2,M(o,s,f),s+=2,U(o,s,u),s+=4,U(o,s,a),s+=4,s+=2,o.buffer}function $t(t){const e=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(e)!==-1}function Ie(t,e,n,r,i,o=0){const s=r.file;U(t,e,i===0?67324752:33639248),e+=4,i===1&&(e+=2),M(t,e,20),e+=2,M(t,e,0),e+=2,M(t,e,r.cpr?8:0),e+=2,U(t,e,0),e+=4,U(t,e,r.crc),e+=4,U(t,e,s.length),e+=4,U(t,e,r.usize),e+=4,M(t,e,Oe(n)),e+=2,M(t,e,0),e+=2,i===1&&(e+=2,e+=2,e+=6,U(t,e,o),e+=4);const c=mt(t,e,n);return e+=c,i===0&&(t.set(s,e),e+=s.length),e}var k;(function(t){t[t.None=0]="None",t[t.Gzip=1]="Gzip",t[t.Zip=2]="Zip"})(k||(k={}));function q(t,e){return Pt(t,e)}function Ce(t){return typeof t=="string"?ke(t,t,"string"):ke(t.title,t.url,t.type||"string",t.body,t.headers)}function Mt(t){if(R)throw new Error("`isDone` should not be used when running in Node.js");if(t instanceof FileReader)return t.readyState===FileReader.DONE;if(t instanceof XMLHttpRequest)return t.readyState===XMLHttpRequest.DONE;throw new Error("unknown data type")}function Ae(t){return t?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function Le(t,e,n){if(R)throw new Error("`readData` should not be used when running in Node.js");return new Promise((r,i)=>{if(Mt(n)){const{error:s}=n;s!=null?i(s??Ae(n instanceof XMLHttpRequest)):r(n);return}let o=!1;n.onerror=s=>{if(o)return;const{error:c}=s.target;i(c??Ae(n instanceof XMLHttpRequest))},n.onprogress=s=>{if(!(!t.shouldUpdate||o))try{s.lengthComputable?t.update({message:e,isIndeterminate:!1,current:s.loaded,max:s.total}):t.update({message:`${e} ${(s.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(c){o=!0,i(c)}},n.onload=s=>{r(n)}})}function Be(t){return/\.gz$/i.test(t)?k.Gzip:/\.zip$/i.test(t)?k.Zip:k.None}const Ot=/^(__MACOSX|.DS_Store)/;async function zt(t,e,n){switch(n){case k.None:return e;case k.Gzip:return Ft(t,e);case k.Zip:const r=await He(t,e.buffer),i=Object.keys(r).filter(o=>!Ot.test(o));if(i.length!==1)throw new Error("can only decompress zip files with a single entry");return r[i[0]]}}async function Q(t,e,n,r){if(e===null)throw new Error("no data given");let i=new Uint8Array(e);if(r!==k.None&&n!=="zip"&&(i=await zt(t,i,r)),n==="binary")return i;if(n==="zip")return await He(t,i.buffer);if(n==="string")return Qe(i);if(n==="xml")return new DOMParser().parseFromString(X(i),"application/xml");if(n==="json")return JSON.parse(X(i));throw new Error(`could not get requested response data '${n}'`)}function Pt(t,e){if(R)return Gt(t,e);let n;return C.create("Read File",async r=>{try{await r.update({message:"Opening file...",canAbort:!0}),n=new FileReader,n.readAsArrayBuffer(t);const o=(await Le(r,"Reading...",n)).result;return await r.update({message:"Processing file...",canAbort:!1}),await Q(r,o,e,Be(t.name))}finally{n=void 0}},()=>{n&&n.abort()})}function Gt(t,e){return C.create("Read File",async n=>{await n.update({message:"Opening file...",canAbort:!1});const r=await t.arrayBuffer();return await n.update({message:"Processing file...",canAbort:!1}),await Q(n,r,e,Be(t.name))})}class S{static get(){if(R)throw new Error("`RequestPool.get` should not be used when running in Node.js");return this.pool.length?this.pool.pop():new XMLHttpRequest}static emptyFunc(){}static deposit(e){this.pool.length<this.poolSize&&(e.onabort=S.emptyFunc,e.onerror=S.emptyFunc,e.onload=S.emptyFunc,e.onprogress=S.emptyFunc,this.pool.push(e))}}S.pool=[];S.poolSize=15;function jt(t,e){if(t.status>=200&&t.status<400){const{response:n}=t;if(S.deposit(t),(e==="binary"||e==="zip")&&n instanceof ArrayBuffer)return new Uint8Array(n);if(e==="string"&&typeof n=="string")return n;if(e==="xml"&&n instanceof XMLDocument)return n;if(e==="json"&&typeof n=="object")return n;throw new Error(`could not get requested response data '${e}'`)}else throw S.deposit(t),new Error(`Download failed with status code ${t.status}`)}function Ht(t){switch(t){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function ke(t,e,n,r,i){if(R)return e.startsWith("file://")?Bt(t,e,n):Kt(t,e,n);let o;return C.create(t||"Download",async s=>{if(o=S.get(),o.open(r?"post":"get",e,!0),i)for(const[a,u]of i)o.setRequestHeader(a,u);o.responseType=Ht(n),o.send(r),await s.update({message:"Waiting for server...",canAbort:!0});const c=await Le(s,"Downloading...",o);return o=void 0,await s.update({message:"Parsing response...",canAbort:!1}),jt(c,n)},()=>{o&&(o.abort(),o=void 0)})}function Dt(){throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.")}function Lt(t){return new Promise((e,n)=>{Dt().readFile(t,(r,i)=>{r?n(r):e(i)})})}function Bt(t,e,n,r,i){if(!R)throw new Error("This function should only be used when running in Node.js");if(!e.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");return C.create(t??"Download",async o=>{const s=e.substring(7);await o.update({message:"Loading file...",canAbort:!1});const c=await Lt(s);return await o.update({message:"Parsing response...",canAbort:!1}),await Q(o,c.buffer,n,k.None)})}function Kt(t,e,n,r,i){if(!R)throw new Error("This function should only be used when running in Node.js");const o=new AbortController;return C.create(t??"Download",async s=>{await s.update({message:"Downloading...",canAbort:!0});const c=await fetch(e,{signal:o.signal});if(!(c.status>=200&&c.status<400))throw new Error(`Download failed with status code ${c.status}`);const f=await c.bytes();return await s.update({message:"Parsing response...",canAbort:!1}),await Q(s,f.buffer,n,k.None)},()=>{o.abort()})}async function fn(t,e,n,r){const i=n.length,o=new Array(n.length);await t.update({message:"Downloading...",current:0,max:i});let s=[],c=[],f=0;for(let u=Math.min(i,r);f<u;f++){const h=n[f];s.push(ve(f,h.id,e.resolve(A.getUrlAsset(e,h.url),h.isBinary?"binary":"string").runAsChild(t))),c.push(f)}let a=0;for(;s.length>0;){const u=await Promise.race(s),h=n[u.index],d=c.indexOf(u.index);if(a++,u.kind==="error"&&!h.canFail)throw new Error(`${h.url}: ${u.error}`);if(t.shouldUpdate&&await t.update({message:"Downloading...",current:a,max:i}),o[u.index]=u,s=s.filter(Se,d),c=c.filter(Se,d),f<i){const b=n[f],m=e.resolve(A.getUrlAsset(e,b.url),b.isBinary?"binary":"string").runAsChild(t);s.push(ve(f,b.id,m)),c.push(f),f++}}return o}function Se(t,e){return this!==e}async function ve(t,e,n){try{return{kind:"ok",result:await n,index:t,id:e}}catch(r){return{kind:"error",error:r,index:t,id:e}}}var A;(function(t){function e(f,a){return{kind:"url",id:de.create22(),url:f,...a}}t.Url=e;function n(f){return{kind:"file",id:de.create22(),name:f.name,file:f}}t.File=n;function r(f){return(f==null?void 0:f.kind)==="url"}t.isUrl=r;function i(f){return(f==null?void 0:f.kind)==="file"}t.isFile=i;function o(f,a,u){return{data:f,dispose:()=>{u.release(a)}}}t.Wrapper=o;function s(f){return typeof f=="string"?f:f.url}t.getUrl=s;function c(f,a,u){return typeof a=="string"?f.tryFindUrl(a,u)||e(a,{body:u}):a}t.getUrlAsset=c})(A||(A={}));class Zt{constructor(){this._assets=new Map}get assets(){return qe(this._assets.values())}tryFindUrl(e,n){const r=this.assets.values();for(;;){const i=r.next();if(i.done)return;const o=i.value.asset;if(A.isUrl(o)&&o.url===e&&(o.body||"")===(n||""))return o}}tryFindFilename(e){const n=this._assets.values();for(;;){const{done:r,value:i}=n.next();if(r)break;if(i.file.name===e)return i.asset}}set(e,n,r){this._assets.set(e.id,{asset:e,file:n,refCount:0,tag:r==null?void 0:r.tag,isStatic:r==null?void 0:r.isStatic})}get(e){return this._assets.get(e.id)}delete(e){return this._assets.delete(e.id)}has(e){return this._assets.has(e.id)}resolve(e,n,r=!0){return A.isUrl(e)?C.create(`Download ${e.title||e.url}`,async i=>{if(this._assets.has(e.id)){const c=this._assets.get(e.id);return c.refCount++,A.Wrapper(await q(c.file,n).runInContext(i),e,this)}if(!r)return A.Wrapper(await Ce({...e,type:n}).runInContext(i),e,this);const o=await Ce({...e,type:"binary"}).runInContext(i),s=new be([o],"raw-data");return this._assets.set(e.id,{asset:e,file:s,refCount:1}),A.Wrapper(await q(s,n).runInContext(i),e,this)}):C.create(`Read ${e.name}`,async i=>{if(this._assets.has(e.id)){const o=this._assets.get(e.id);return o.refCount++,A.Wrapper(await q(o.file,n).runInContext(i),e,this)}if(!(e.file instanceof be))throw new Error(`Cannot resolve file asset '${e.name}' (${e.id})`);return r&&this._assets.set(e.id,{asset:e,file:e.file,refCount:1}),A.Wrapper(await q(e.file,n).runInContext(i),e,this)})}release(e){const n=this._assets.get(e.id);n&&(n.refCount--,n.refCount<=0&&!n.isStatic&&this._assets.delete(e.id))}clearTag(e){const n=Array.from(this._assets.keys());for(const r of n){const i=this._assets.get(r);i&&i.tag===e&&this._assets.delete(r)}}clear(){this._assets.clear()}dispose(){this.clear()}}const cn=Object.freeze(Object.defineProperty({__proto__:null,get Asset(){return A},AssetManager:Zt},Symbol.toStringTag,{value:"Module"}));export{A,sn as C,st as E,Xt as O,R,Qt as S,C as T,on as Z,Ve as a,qe as b,Jt as c,Vt as d,en as e,qt as f,X as g,fn as h,nn as i,Ft as j,Qe as k,rn as l,nt as m,Yt as n,He as o,Zt as p,Ce as q,q as r,cn as s,tn as u};
//# sourceMappingURL=assets-C0Og-5xw.js.map
